# Sample workflow for building and deploying a Jekyll site to GitHub Pages
name: Build Ceres from c++ source

on:
  push:
    branches: [ $default-branch ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Download Emscripten
      run: >
        cwd=$(pwd)
        bdir=$(pwd)/build

        echo $bdir
        git clone -b "3.1.51" https://github.com/emscripten-core/emsdk.git $bdir/emsdk

    - name: Activate Emscripten
      run: >
        #Enter that directory
        cd $bdir/emsdk
        
        # Download and install the latest SDK tools.
        $bdir/emsdk/upstream/emscripten/em++ -v || ./emsdk install latest
        
        # Make the "latest" SDK "active" for the current user. (writes ~/.emscripten file)
        ./emsdk activate latest
        
        # Activate PATH and other environment variables in the current terminal
        source ./emsdk_env.sh
        
#    - name: make
#      run: make
#    - name: make check
#      run: make check
#    - name: make distcheck
#      run: make distcheck
